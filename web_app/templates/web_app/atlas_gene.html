{% extends "base.html" %}

{% block title %}{{species}} {{gene|default:'Gene'}}{% endblock title %}

{% block content %}

{% load static %}
{% include 'web_app/components/atlas_selection.html' %}

{% include 'web_app/components/gene_selection.html' with gene=gene %}
{% include 'web_app/components/warning_alert.html' %}

{% if gene %}
    <h1 class="h3 pt-2" id="expression">
        Gene expression
        {% include 'web_app/components/clipboard_button.html' with id='expression' %}
        {% include 'web_app/components/data_button.html' %}
    </h1>
    <div id="{{gene}}" class="container"></div>

    <h1 class="h3 pt-2" id="orthologs">
        Orthologs
        {% include 'web_app/components/clipboard_button.html' with id='orthologs' %}
        {% include 'web_app/components/data_button.html' %}
    </h1>

    <div id="ortholog-plots"></div>
    <template id="ortholog-template">
        <h2 class="h6 pt-2">
            <i><span id="ortholog-species" class="badge bg-secondary rounded-pill">organism</span></i>
            <span id="ortholog-gene">Gene</span></h2>
        <div id="ortholog-plot" class="container"></div>
    </template>

    <script type="text/javascript" src="{% static 'web_app/js/barplot.js' %}"></script>
    <script type="text/javascript">
        // Create URL for REST API
        var url = '{% url 'rest:ortholog-list' %}';
        var params = new URLSearchParams({
		    gene: '{{gene}}',
		    expression: true,
		    limit: 0
	    });
	    var apiURL = url + "?" + params.toString();

        // Fetch data from the API and create plots
        const template  = document.getElementById('ortholog-template');
        const container = document.getElementById('ortholog-plots');

        fetch(apiURL)
            .then(response => response.json())
            .then(data =>
                data.forEach(item => {
                    gene = item.gene_name;
                    if (gene != '{{gene}}') {
                        clone = document.importNode(template.content, true);
                        clone.getElementById('ortholog-gene').innerHTML = gene;
                        clone.getElementById('ortholog-species').innerHTML = `<img class="rounded-circle" style="box-shadow: 0px 0px 2px white !important;;" src="${item.species.image_url}" height="24px"> ${item.species.scientific_name}`;
                        clone.getElementById('ortholog-plot').id = gene;
                        container.appendChild(clone);
                    }
                    createExpressionBarPlot("#" + gene, gene, item.expression);
                })
            )
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    </script>
{% else %}
    <div class="row">
        <div class="col-auto" style="width: 350px; display: flex; justify-content: space-around; align-items: baseline;">
            <span class="placeholder" style="width: 20px; height: 200px;"></span>
            <span class="placeholder" style="width: 20px; height: 130px;"></span>
            <span class="placeholder" style="width: 20px; height: 120px;"></span>
            <span class="placeholder" style="width: 20px; height: 160px;"></span>
            <span class="placeholder" style="width: 20px; height: 175px;"></span>
            <span class="placeholder" style="width: 20px; height: 210px;"></span>
            <span class="placeholder" style="width: 20px; height: 120px;"></span>
            <span class="placeholder" style="width: 20px; height: 160px;"></span>
            <span class="placeholder" style="width: 20px; height: 130px;"></span>
            <span class="placeholder" style="width: 20px; height: 160px;"></span>
            <span class="placeholder" style="width: 20px; height: 120px;"></span>
        </div>
        <div class="col-auto">
            <span class="placeholder" style="height: .5em; width: 100px;"></span></br>
            
            <span class="placeholder" style="height: .5em; width: .5em;"></span>
            <span class="placeholder" style="height: .5em; width: 60px;"></span></br>
            
            <span class="placeholder" style="height: .5em; width: .5em;"></span>
            <span class="placeholder" style="height: .5em; width: 40px;"></span></br>
            
            <span class="placeholder" style="height: .5em; width: .5em;"></span>
            <span class="placeholder" style="height: .5em; width: 50px;"></span></br>
            
            <span class="placeholder" style="height: .5em; width: .5em;"></span>
            <span class="placeholder" style="height: .5em; width: 60px;"></span>
        </div>
    </div>
{% endif %}

{% endblock content %}