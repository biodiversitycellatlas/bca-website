{% extends "base.html" %}

{% block title %}{{species}} Markers{% endblock title %}

{% block content %}
{% include 'web_app/atlas-select.html' %}

<div class="container">
    <div class="row">
        <div class="col-4">  
            <form id="markers-form">
                <fieldset>
                    <legend class="h5">Cell selection</legend>
                    <div class="btn-toolbar row mb-3" role="toolbar" aria-label="Cell selection">
                        <label class="col-form-label col-lg-4">Select by </label>
                        <div class="btn-group-vertical col-lg-8" role="group" aria-label="Cell selection">
                          <input type="radio" class="btn-check" name="select" id="cell_types" value="cell_types" autocomplete="off" {% if not query.select or query.select == 'cell_types' %}checked{% endif %}>
                          <label class="btn btn-outline-primary" for="cell_types">Cell types</label>
        
                          <input type="radio" class="btn-check" name="select" id="metacells" value="metacells" autocomplete="off" {% if query.select == 'metacells' %}checked{% endif %}>
                          <label class="btn btn-outline-primary" for="metacells">Metacells</label>
                          
                          <input type="radio" class="btn-check" name="select" id="custom" value="custom" autocomplete="off" {% if query.select == 'custom' %}checked{% endif %}>
                          <label class="btn btn-outline-primary" for="custom">Custom</label>
                        </div>
                    </div>
                </fieldset>
                
                <fieldset>
                    <legend class="h5">Fold-change</legend>
                    <div class="mb-3">
                        <label class="col-form-label" for="fc_min_type">Min. fold-change <i class="fa fa-circle-question" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Minimum fold-change for gene filtering"></i></label>
                        <select class="form-select" name="fc_min_type" id="fc_min_type" aria-label="Select example" value="median">
                            <option value="absolute" {% if query.fc_max_bg_type == 'absolute' %}selected{% endif %}>Absolute</option>
                            <option value="median" {% if query.fc_max_bg_type == 'median' %}selected{% endif %}>Median</option>
                        </select>
                    </div>

                    <input type="range" class="js-range-slider" id="fc_min" name="fc_min" value="{{query.fc_min|default:2}}" step="0.1">
                    <script>
                        $("#fc_min").ionRangeSlider({
                            min: 0,
                            max: 5,
                            from: {{query.fc_min|default:2}},
                            step: 0.1,
                            grid: false,
                            skin: "round"
                        });
                    </script>

                    <hr>
                    <div class="mb-3">
                        <label class="col-form-label" for="fc_max_bg_type">Max. fold-change (background) <i class="fa fa-circle-question" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Maximum fold-change in non-selected cells"></i></label>
                        <select class="form-select" id="fc_max_bg_type" name="fc_max_bg_type" aria-label="Select example" onchange="toggleMaxFCslider(this, '#fc_max_bg');">
                            <option value="ignore" {% if query.fc_max_bg_type == 'ignore' %}selected{% endif %}>Ignore</option>
                            <option value="absolute" {% if query.fc_max_bg_type == 'absolute' %}selected{% endif %}>Absolute</option>
                            <option value="median" {% if query.fc_max_bg_type == 'median' %}selected{% endif %}>Median</option>
                        </select>
                    </div>

                    <input type="range" class="js-range-slider" id="fc_max_bg" name="fc_max_bg" value="{{query.fc_max_bg|default:3}}" step="0.1" disabled>
                    <script>
                        $("#fc_max_bg").ionRangeSlider({
                            min: 0,
                            max: 5,
                            from: {{query.fc_max_bg|default:3}},
                            step: 0.1,
                            grid: false,
                            skin: "round"
                        });

                        function toggleMaxFCslider(elem, id) {
                            var slider = $(id).data("ionRangeSlider");
                            var html   = slider["result"]["slider"];
                            if (elem.value == 'ignore') {
                                slider.update({ disable: true });
                            } else {
                                slider.update({ disable: false });
                            }
                        }

                        // Hide slider depending on value of #fc_max_bg_type
                        toggleMaxFCslider($('#fc_max_bg_type')[0], '#fc_max_bg')
                    </script>
                    <button type="submit" class="btn btn-primary my-3">List markers</button>
                </fieldset>
            </form>
        </div>
        <div class="col">
            {% if query %}
                Some table
            {% else %}
                <table class="table">
                    <thead>
                        <tr style="border-bottom: 2px solid lightgray;">
                            <th scope="col">#</span></th>
                            <th scope="col">Gene ID</span></th>
                            <th scope="col">Name</span></th>
                            <th scope="col">Domains</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row"><span class="placeholder" style="width: 20px;"></span></th>
                            <td><span class="placeholder" style="width: 110px;"></span></td>
                            <td><span class="placeholder" style="width: 110px;"></span></td>
                            <td><span class="placeholder" style="width: 95px;"></span></td>
                        </tr>
                        <tr>
                            <th scope="row"><span class="placeholder" style="width: 15px;"></span></th>
                            <td><span class="placeholder" style="width: 125px;"></span></td>
                            <td><span class="placeholder" style="width: 90px;"></span></td>
                            <td><span class="placeholder" style="width: 89px;"></span></td>
                        </tr>
                        <tr>
                            <th scope="row"><span class="placeholder" style="width: 18px;"></span></th>
                            <td><span class="placeholder" style="width: 118px;"></span></td>
                            <td><span class="placeholder" style="width: 100px;"></span></td>
                            <td><span class="placeholder" style="width: 100px;"></span></td>
                        </tr>
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}