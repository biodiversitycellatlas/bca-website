{% comment %}

Metacell selection dropdown

Features:
- Multiple selection of metacells by either cell type or specific metacell
- Metacell values can be converted to ranges (e.g., 1,2,3,5,6 to 1-3,5-6)
- On form submission, metacell selection is transformed into comma-separated
  string for URL query params and the page is reloaded with such params

Input:
- name: form field name (default: 'metacells')
- metacell_dict: dictionary of metacells
- selected: selected metacells
- selected2: selected metacells (backup for )
- placeholder: placeholder text

{% endcomment %}

<select required
        name="{{ name|default:'metacells' }}"
        value=""
        id="metacells"
        multiple
        placeholder="{{ placeholder|default:'Select metacells...' }}">
    <option value="">
    </option>
    {% for key, value in metacell_dict.items %}
        <optgroup label="{{ key }}">
            {% if key == 'Cell types' %}
                {% for type, mc in value.items %}
                    <option value="{{ type }}"
                            data-type="cell_types"
                            data-metacells="{{ mc|join:',' }}"
                            data-color="{{ type.color }}">
                        {{ type }}
                    </option>
                {% endfor %}
            {% elif key == 'Metacells' %}
                {% for mc in value %}
                    <option value="{{ mc.name }}"
                            data-type="metacells"
                            data-color="{{ mc.type.color }}"
                            data-celltype="{{ mc.type }}">
                        {{ mc.name }}
                    </option>
                {% endfor %}
            {% endif %}
        </optgroup>
    {% endfor %}
</select>

<!-- Metacell: selectize.js JavaScript options -->
<script type="module">
    {% load static %}
    import { initMetacellSelectize } from "{% static 'app/js/select/metacell.js' %}";
    $(function () {
        initMetacellSelectize("{{selected}}", "{{selected2}}");
    })
</script>
