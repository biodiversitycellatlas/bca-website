{% extends "base.html" %}

{% comment %}

Downloads page

{% endcomment %}

{% block title %}Downloads{% endblock title %}

{% block content %}
<h1 class="h3">Data download</h1>

<p>Find the download links for single species data in the table below.</p>

<p>To download data in bulk, we recommend using our <a href="{% url 'api' %}">REST API</a>.</p>

<hr/>

{% load custom_filters %}

<!-- Species downloads -->
<h2 class="h4" id="species">
    Species data
    {% load section_buttons %}
    {% clipboard_button id='species' %}
</h2>

<table id="species_table" class="display nowrap" style="width:100%">
    <thead>
        <tr>
            <th>Species</th>
            <th>Common name</th>
            <th>Proteome</th>
            <th>DIAMOND database</th>
        </tr>
    </thead>
    <tbody>
        {% with file_types="Proteome,DIAMOND" %}
            {% for species in species_all %}
                <tr>
                    <td>
                        <img width="25px" src="{{ species.image_url }}">
                        {{ species.html }}
                    </td>
                    <td>{{ species.common_name|default_if_none:"–" }}</td>

                    {% for file_type in file_types|split:"," %}
                        {% with file=species.files.all|get_file_type:file_type %}
                        <td>
                            {% if file %}
                                <a href="{% url 'download_file' file.slug %}">
                                    {{ file.ext.upper }}
                                </a>
                            {% else %}
                                –
                            {% endif %}
                        </td>
                        {% endwith %}
                    {% endfor %}
                </tr>
            {% endfor %}
        {% endwith %}
    </tbody>
</table>

<hr/>

<!-- Dataset downloads -->
<h2 class="h4" id="dataset">
    Dataset data
    {% clipboard_button id='dataset' %}
</h2>

<table id="dataset_table" class="display nowrap" style="width:100%">
    <thead>
        <tr>
            <th>Species</th>
            <th>Common name</th>
            <th>Dataset name</th>

            <th>Dataset information</th>
            <th>Summary statistics</th>

            <th>Single cell data</th>
            <th>Metacell data</th>
            <th>Metacell counts</th>
        </tr>
    </thead>
    <tbody>
        {% for dataset in datasets_all %}
            <tr>
                <td>
                    <img width="25px" src="{{ dataset.image_url|default_if_none:dataset.species.image_url }}">
                    {{ dataset.species.html }}
                </td>
                <td>{{ dataset.species.common_name|default_if_none:"–" }}</td>
                <td>{{ dataset.name|default_if_none:"–" }}</td>

                {% load download_links %}
                <td>{% download_dataset_detail 'rest:dataset-detail' dataset.slug 'dataset-info' %}</td>
                <td>{% download_dataset_detail 'rest:stats-detail' dataset.slug 'summary-stats' %}</td>
                <td>{% download_dataset_list 'rest:singlecell-list' dataset.slug 'single-cells' %}</td>
                <td>{% download_dataset_list 'rest:metacell-list' dataset.slug 'metacells' %}</td>
                <td>{% download_dataset_list 'rest:metacellcount-list' dataset.slug 'metacell-counts' %}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
$('#species_table, #dataset_table').DataTable({
    responsive: true,
    pageLength: 25,
    scrollX: true,
    language: { "search": "" }
});

$('.dt-search input').attr("placeholder", "Search table...");
</script>

{% endblock content %}